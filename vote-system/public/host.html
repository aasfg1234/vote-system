<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»æŒäººæ§åˆ¶å°</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Serif+TC:wght@400;600;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body id="host-page">
    <div class="font-control-box">
        <button id="font-up" class="font-btn" title="æ”¾å¤§å­—é«”">A+</button>
        <button id="font-down" class="font-btn" title="ç¸®å°å­—é«”">A-</button>
    </div>

    <div id="host-auth-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-paper); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center;">
        <div class="container" style="max-width:400px; text-align:center; padding:50px;">
            <div style="font-size:3rem; margin-bottom:20px;">ğŸ”’</div>
            <h2 style="margin-bottom:10px;">ä¸»æŒäººé©—è­‰</h2>
            <p style="color:var(--text-light); margin-bottom:30px; font-family:'Noto Serif TC'">è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼ä»¥è§£é–æ§åˆ¶å°</p>
            <input type="password" id="host-password-input" placeholder="Password" style="text-align:center; letter-spacing:3px; font-size:1.2rem; margin-bottom:20px;">
            <button id="host-login-submit" class="btn">è§£é–ç™»å…¥</button>
            <p id="login-error-msg" style="color:var(--danger); margin-top:15px; opacity:0; transition:opacity 0.3s;">å¯†ç¢¼éŒ¯èª¤</p>
            <a href="index.html" style="display:block; margin-top:30px; color:var(--text-light); text-decoration:none; font-size:0.9rem;">â† è¿”å›é¦–é </a>
        </div>
    </div>

    <div id="settings-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:5000; display:flex; justify-content:center; align-items:center;">
        <div class="container" style="max-width:500px; padding:30px; position:relative; max-height: 90vh; overflow-y: auto;">
            <button id="close-settings-btn" style="position:absolute; top:15px; right:15px; background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            <h2 style="margin-bottom:20px; text-align:center;">âš™ï¸ ç³»çµ±è¨­å®š</h2>

            <div style="border-bottom:1px dashed var(--border); padding-bottom:20px; margin-bottom:20px;">
                <h3 style="font-size:1.1rem; margin-bottom:10px;">ğŸ‘¤ ä¿®æ”¹ä¸»æŒäººæš±ç¨±</h3>
                <input type="text" id="new-host-name" placeholder="é è¨­: HOST" style="margin-bottom:10px;">
                <button id="save-host-name-btn" class="btn" style="background:var(--primary); color:white;">å„²å­˜æš±ç¨±</button>
            </div>

            <div style="border-bottom:1px dashed var(--border); padding-bottom:20px; margin-bottom:20px;">
                <h3 style="font-size:1.1rem; margin-bottom:10px;">ğŸ”‘ ä¿®æ”¹ä¸»æŒäººå¯†ç¢¼</h3>
                <input type="text" id="new-host-password" placeholder="è¼¸å…¥æ–°å¯†ç¢¼" style="margin-bottom:10px;">
                <button id="save-password-btn" class="btn" style="background:var(--text-main); color:white;">å„²å­˜æ–°å¯†ç¢¼</button>
            </div>

            <div>
                <h3 style="font-size:1.1rem; margin-bottom:10px;">â• æ–°å¢å¿«é€Ÿæ¨£æ¿</h3>
                <input type="text" id="new-preset-name" placeholder="æ¨£æ¿åç¨± (å¦‚: ğŸ‘” ç©¿æ­é¡Œ)" style="margin-bottom:8px;">
                <input type="text" id="new-preset-question" placeholder="é è¨­é¡Œç›®" style="margin-bottom:8px;">
                <input type="text" id="new-preset-options" placeholder="é¸é … (ç”¨é€—è™Ÿåˆ†éš”ï¼Œå¦‚: ç´…,è—,ç¶ )" style="margin-bottom:10px;">
                <button id="add-preset-btn" class="btn" style="background:var(--success);">æ–°å¢æ¨£æ¿</button>
            </div>
        </div>
    </div>

    <div class="host-grid">
        <div class="container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0;">ğŸ› æ§åˆ¶é¢æ¿</h2>
                <button id="open-settings-btn" style="background:none; border:none; font-size:1.5rem; cursor:pointer;" title="è¨­å®š">âš™ï¸</button>
            </div>
            
            <div class="pin-badge">PIN: <span id="host-pin-display">----</span></div>
            
            <div class="host-controls">
                <div class="form-group">
                    <label>å¿«é€Ÿæ¨£æ¿ï¼š</label>
                    <div id="preset-buttons" style="display:flex; gap:8px; margin-bottom:15px; flex-wrap:wrap;"></div>
                    
                    <label>é¡Œç›®</label>
                    <input type="text" id="h-question" placeholder="è«‹è¼¸å…¥è¨è«–è­°é¡Œ..." value="ç¯„ä¾‹ï¼šæ¥ä¸‹ä¾†çš„å„ªå…ˆé †åºï¼Ÿ">
                </div>
                
                <div class="form-group">
                    <label>é¸é …</label>
                    <input type="text" class="opt-text" value="é¸é … A" style="margin-bottom:8px;">
                    <input type="text" class="opt-text" value="é¸é … B" style="margin-bottom:8px;">
                    <input type="text" class="opt-text" value="é¸é … C" style="margin-bottom:8px;">
                    <input type="text" class="opt-text" placeholder="é¸é … D..." style="margin-bottom:8px;">
                </div>
                
                <div class="form-group" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:15px;">
                    <div style="flex:1; min-width: 120px;">
                        <label>å€’æ•¸ç§’æ•¸</label>
                        <input type="number" id="h-timer" value="0">
                    </div>
                    <div style="flex:1; display:flex; align-items:center; padding-top:25px;">
                        <input type="checkbox" id="h-multi" style="margin-right:5px;">
                        <label for="h-multi">è¤‡é¸</label>
                    </div>
                    <div style="flex:1; display:flex; align-items:center; padding-top:25px;">
                        <input type="checkbox" id="h-blind" style="margin-right:5px;">
                        <label for="h-blind" style="color:var(--primary); font-weight:bold;">ğŸ™ˆ ç›²æ¸¬</label>
                    </div>
                </div>

                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button id="clear-form-btn" class="btn" style="background:#8e8d8a; flex:1;">ğŸ§¹ æ¸…ç©º</button>
                    <button id="start-vote-btn" class="btn" style="flex:2;">ğŸš€ ç™¼å¸ƒ</button>
                </div>
                <button id="stop-vote-btn" class="btn btn-stop">ğŸ›‘ å¼·åˆ¶çµæŸ (æœ¬é¡Œ)</button>
                
                <hr style="border:0; border-top:1px dashed var(--border); margin:20px 0;">
                
                <button id="terminate-btn" class="btn" style="background:var(--text-main); color:white;">ğŸ çµæŸæ•´å ´æœƒè­°</button>
                <button id="export-btn" class="btn" style="background:var(--success); margin-top:10px;">ğŸ“¥ ä¸‹è¼‰çµæœ (CSV)</button>
            </div>
        </div>

        <div class="container">
            <div class="link-info-box">
                <div class="link-label">æƒæåŠ å…¥æœƒè­°</div>
                <div id="qrcode" style="display:flex; justify-content:center; margin: 15px 0;"></div>
                <div class="link-label">æˆ–è¼¸å…¥ç¶²å€</div>
                <a id="join-link" href="#" target="_blank" class="link-text">Loading...</a>
                <hr style="border:0; border-top:1px dashed var(--border); margin:15px 0;">
                <button id="open-projector-btn" class="btn" style="background:#8b5cf6;">
                    ğŸ“º é–‹å•Ÿå¤§è¢å¹•æŠ•å½±é é¢
                </button>
            </div>

            <h2 style="margin-bottom:20px;">ğŸ“± ç¾å ´é è¦½</h2>
            
            <div id="vote-screen">
                <div class="status-bar">
                    <span id="status-text">ç­‰å¾…ä¸­</span>
                    <span>
                        â± <span id="timer">0s</span> | 
                        ğŸ‘¥ <span id="joined-count">0</span> | 
                        ğŸ—³ï¸ <span id="total-votes">0</span>
                    </span>
                </div>
                <div id="question-text" class="question">ç­‰å¾…ç™¼å¸ƒ...</div>
                <div id="options-container"></div>
            </div>

            <div class="history-section">
                <h3 style="font-family:'Noto Serif TC'; margin-bottom:15px; color:var(--text-light);">ğŸ—„ï¸ æœƒè­°æ­·å²ç´€éŒ„</h3>
                <div id="history-container">
                    <p style="text-align:center; color:#ccc; font-size:0.9rem;">å°šæœªæœ‰æ­¸æª”ç´€éŒ„</p>
                </div>
            </div>
        </div>
    </div>

    <div id="toast"></div>
    <input type="hidden" id="pin-input"> 
    <button id="join-btn" class="hidden"></button>

    <script src="/socket.io/socket.io.js"></script>
    <script src="app.js"></script>
    <script>
        window.addEventListener('load', () => {
            let baseUrl = window.location.href.replace('/host.html', '');
            if(baseUrl.endsWith('/')) baseUrl = baseUrl.slice(0, -1);
            const targetUrl = baseUrl + '/participant.html';

            const linkEl = document.getElementById('join-link');
            linkEl.textContent = targetUrl;
            linkEl.href = targetUrl;

            new QRCode(document.getElementById("qrcode"), {
                text: targetUrl,
                width: 120, height: 120,
                colorDark : "#3f4238", colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        });
    </script>
</body>
</html>
